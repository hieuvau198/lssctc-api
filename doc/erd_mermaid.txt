erDiagram
    %% User Management
    roles {
        tinyint id PK
        nvarchar name UK
    }
    
    users {
        int id PK
        nvarchar username UK
        nvarchar password
        nvarchar email UK
        nvarchar fullname
        nvarchar profile_image_url
        tinyint role_id FK
        datetime2 created_at
        datetime2 updated_at
        bit is_deleted
    }
    
    learners {
        int user_id PK,FK
        date date_of_birth
        nvarchar enrollment_status
        bit is_deleted
    }
    
    instructors {
        int user_id PK,FK
        nvarchar bio
        nvarchar specialization
        int years_experience
        bit is_deleted
    }
    
    staff {
        int user_id PK,FK
        nvarchar employment_status
        bit is_deleted
    }
    
    admins {
        int user_id PK,FK
        bit is_deleted
    }
    
    %% Course Management
    course_categories {
        int id PK
        nvarchar name UK
    }
    
    course_levels {
        int id PK
        nvarchar name UK
    }
    
    course_definitions {
        int id PK
        nvarchar title
        nvarchar course_code UK
        nvarchar description
        int category_id FK
        int level_id FK
        int duration
        bit is_deleted
    }
    
    courses {
        int id PK
        int course_definition_id FK
        nvarchar title
        nvarchar course_code
        nvarchar description
        nvarchar category
        nvarchar level
        date start_date
        date end_date
        nvarchar location
        nvarchar status
        bit is_deleted
    }
    
    course_prerequisites {
        int course_id PK,FK
        int prerequisite_id PK,FK
    }
    
    course_instructors {
        int course_id PK,FK
        int user_id PK,FK
    }
    
    course_learners {
        int course_id PK,FK
        int user_id PK,FK
    }
    
    course_enrollments {
        int id PK
        int course_id FK
        int user_id FK
        datetime2 enrollment_date
        nvarchar status
        bit is_deleted
    }
    
    material_types {
        int id PK
        nvarchar name UK
    }
    
    learning_materials {
        int id PK
        nvarchar title
        nvarchar content
        nvarchar source_url
        int material_type_id FK
        bit is_deleted
    }
    
    course_materials {
        int course_id PK,FK
        int material_id PK,FK
    }
    
    %% Training Sessions
    session_types {
        int id PK
        nvarchar name UK
        nvarchar description
        datetime2 created_at
        datetime2 updated_at
    }
    
    training_sessions {
        int id PK
        nvarchar name
        nvarchar description
        int session_type_id FK
        int instructor_id FK
        datetime2 start_date
        datetime2 end_date
        nvarchar location
        datetime2 created_at
        datetime2 updated_at
    }
    
    course_sessions {
        int id PK
        int course_id FK
        int training_session_id FK
    }
    
    session_schedules {
        int id PK
        int trainingsession_id FK
        date schedule_date
        time start_time
        time end_time
        datetime2 created_at
        datetime2 updated_at
    }
    
    session_attendances {
        int id PK
        int trainingsession_id FK
        int learner_id FK
        nvarchar attendance_status
        datetime2 attended_at
        datetime2 created_at
        datetime2 updated_at
    }
    
    session_learners {
        int id PK
        int trainingsession_id FK
        int learner_id FK
        nvarchar enrollment_status
        datetime2 created_at
        datetime2 updated_at
    }
    
    %% Testing System
    tests {
        int id PK
        nvarchar name
        nvarchar description
        int duration_minutes
        decimal total_points
        datetime2 created_at
        datetime2 updated_at
        bit is_deleted
    }
    
    test_questions {
        int id PK
        int test_id FK
        bit is_multiple_answers
        int option_quantity
        int answer_quantity
        decimal points
        nvarchar explanation
        bit is_deleted
    }
    
    question_options {
        int id PK
        int question_id FK
        bit is_correct
        decimal points
        int order_index
        bit is_deleted
    }
    
    learner_tests {
        int id PK
        int learner_id FK
        int test_id FK
        int attempt_number
        decimal score
        datetime2 started_at
        datetime2 completed_at
        nvarchar status
        nvarchar review
        bit is_deleted
    }
    
    learner_test_questions {
        int id PK
        int learner_test_id FK
        int question_id FK
        int order_index
        decimal points
        bit is_deleted
    }
    
    learner_question_answers {
        int id PK
        int learner_test_question_id FK
        int option_id FK
        nvarchar answer_text
        bit is_correct
        decimal points
        bit is_deleted
    }
    
    %% Simulation Tasks
    simulation_tasks {
        int id PK
        int course_id FK
        nvarchar name
        nvarchar description
        nvarchar passing_criteria
        datetime2 created_at
        datetime2 updated_at
    }
    
    training_session_simulation_tasks {
        int id PK
        int training_session_id FK
        int simulation_task_id FK
        datetime2 assigned_at
    }
    
    learner_simulation_tasks {
        int id PK
        int learner_id FK
        int training_session_simulation_task_id FK
        nvarchar status
        nvarchar progress
        nvarchar feedback
        datetime2 started_at
        datetime2 completed_at
    }
    
    %% Relationships
    roles ||--o{ users : "has role"
    users ||--o| learners : "is learner"
    users ||--o| instructors : "is instructor"
    users ||--o| staff : "is staff"
    users ||--o| admins : "is admin"
    
    course_categories ||--o{ course_definitions : "belongs to"
    course_levels ||--o{ course_definitions : "has level"
    course_definitions ||--o{ courses : "instantiated as"
    
    courses ||--o{ course_prerequisites : "has prerequisite"
    courses ||--o{ course_prerequisites : "is prerequisite for"
    courses ||--o{ course_instructors : "taught by"
    users ||--o{ course_instructors : "teaches"
    courses ||--o{ course_learners : "enrolled learners"
    users ||--o{ course_learners : "enrolled in"
    courses ||--o{ course_enrollments : "enrollments"
    users ||--o{ course_enrollments : "enrolled by"
    
    material_types ||--o{ learning_materials : "categorizes"
    courses ||--o{ course_materials : "uses materials"
    learning_materials ||--o{ course_materials : "used in courses"
    
    session_types ||--o{ training_sessions : "categorizes"
    instructors ||--o{ training_sessions : "conducts"
    courses ||--o{ course_sessions : "includes sessions"
    training_sessions ||--o{ course_sessions : "part of course"
    training_sessions ||--o{ session_schedules : "scheduled"
    training_sessions ||--o{ session_attendances : "attendance tracked"
    learners ||--o{ session_attendances : "attends"
    training_sessions ||--o{ session_learners : "enrolled learners"
    learners ||--o{ session_learners : "enrolls in"
    
    tests ||--o{ test_questions : "contains"
    test_questions ||--o{ question_options : "has options"
    learners ||--o{ learner_tests : "takes tests"
    tests ||--o{ learner_tests : "taken by"
    learner_tests ||--o{ learner_test_questions : "includes questions"
    test_questions ||--o{ learner_test_questions : "answered in"
    learner_test_questions ||--o{ learner_question_answers : "has answers"
    question_options ||--o{ learner_question_answers : "selected as"
    
    courses ||--o{ simulation_tasks : "includes tasks"
    training_sessions ||--o{ training_session_simulation_tasks : "assigns tasks"
    simulation_tasks ||--o{ training_session_simulation_tasks : "assigned to sessions"
    learners ||--o{ learner_simulation_tasks : "performs tasks"
    training_session_simulation_tasks ||--o{ learner_simulation_tasks : "completed by learners"